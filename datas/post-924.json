{
    "link": "https://bbs.nga.cn/read.php?tid=40570664",
    "title": "[求助] 请问有懂NAT内网穿越技术的老哥吗，我看书有个问题不太懂。。",
    "post_time": "2024-06-17 21:05",
    "uid": "64283382",
    "content": "[求助] 请问有懂NAT内网穿越技术的老哥吗，我看书有个问题不太懂。。",
    "replies": [
        {
            "mid": "420082",
            "mtime": "2024-06-17 22:52",
            "mcontent": "应该不行吧，如果公网只看到一个端口的话，消息返回的时候路由器没法区分返回的消息是给哪个电脑，也区分不了电脑上的哪个应用"
        },
        {
            "mid": "63521444",
            "mtime": "2024-06-17 23:11",
            "mcontent": "单向访问只需要知道目标ip和目标端口就行一般的防火墙都会允许出站，只要有目标地址包即可送达这是客户端的行为所以我认为，只有服务监听端口才会占用端口才会有端口号纯客户端没有端口的说法假如你需要服务器主动连接你，即同时当客户端和服务端那你确实需要一个公网ip的端口，需要在网关处做端口映射将公网ip映射为内网ip所以一个公网最多只能有65535个内网服务但实际上，有一种反向代理服务可以解决这个问题比如nginx，可以复用一个端口 通过不同的域名连接到不同的内网服务当客户端连接nginx服务时，nginx作为桥梁 为客户端和服务建立连接所以公网看不到你单向连接的端口，一个公网可以给无限多的电脑用"
        },
        {
            "mid": "64283382",
            "mtime": "2024-06-17 23:41",
            "mcontent": "谢谢，理解了。但是我看sniffer这种网络查看器。本机连接其他网络 本机虽然没指定端口，但是会随机一个很大的端口。服务器端是80,21这种。但是本机这个端口是不是也是一个端口，只是为了链接会随机使用1个。理论上本机访问65535个网络就满了呢"
        },
        {
            "mid": "-1",
            "mtime": "2024-06-18 08:44",
            "mcontent": "对的，TCP协议的端口号只有16比特。"
        },
        {
            "mid": "42937034",
            "mtime": "2024-06-20 12:39",
            "mcontent": "其实有端口的，tcp请求是随机端口(进程)访问固定端口的，所以抓包会看到一个固定端口以及一串数值很大的随机端口，没有这个随机端口只能单向发包不能回包的，请求就会中断。"
        },
        {
            "mid": "60920558",
            "mtime": "2024-06-21 15:53",
            "mcontent": "1. 服务器端口是常开的，只要支持并发，可以很多人一起访问，不会你访问了别人就无法访问，这个跟NAT没关系，是并发问题2. 你自己的端口叫客户端的端口，一般是系统内核随机产生的，找个空的跟目标连起来，跟NAT也没关系3. NAT你电脑不会处理的，这是你父网络路由器的工作，因为跨网段，你只是路由器下面的一个子IP，路由器假设有公网IP，跟服务端通信后，服务端回给路由器需要有个代号告诉路由器是回给你，所以路由器本地会把你的IP映射一个端口"
        }
    ]
}