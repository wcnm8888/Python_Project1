{
    "link": "https://bbs.nga.cn/read.php?tid=41619931",
    "title": "[求助] 不懂就问各位程序员，什么情况下会需要把IP写死？",
    "post_time": "2024-09-11 00:20",
    "uid": "10403273",
    "content": "本人不是程序员，只是工作中会和不同的研发、运维打交道",
    "replies": [
        {
            "mid": "992969",
            "mtime": "2024-09-11 08:30",
            "mcontent": "1懒得搞dns2没钱搞dns3不会搞dns3.5我就是dns4固定的内网(常见于自动化行业)5临时用一下"
        },
        {
            "mid": "60028416",
            "mtime": "2024-09-11 08:30",
            "mcontent": "只写死过127.0.0.1"
        },
        {
            "mid": "42368844",
            "mtime": "2024-09-11 08:58",
            "mcontent": "比如说业务方家大业大通过IP 做一些域名解析的事情阿里系腾系都见过的操作"
        },
        {
            "mid": "3260753",
            "mtime": "2024-09-11 10:14",
            "mcontent": "用IP其实还算挺常见的，就是懒的搞DNS 但是至少是要用配置文件不至于写死在代码里吧"
        },
        {
            "mid": "63782286",
            "mtime": "2024-09-11 11:15",
            "mcontent": "那你可以建议他们配一个dns，利用dns来方便地做migration呗。"
        },
        {
            "mid": "34353632",
            "mtime": "2024-09-11 12:41",
            "mcontent": "无他，懒得搞DNS。很多大厂搬了工区都会因为这事连不上集群"
        },
        {
            "mid": "60024774",
            "mtime": "2024-09-11 17:48",
            "mcontent": "大部分是懒吧，md最后还不是运维背锅"
        },
        {
            "mid": "62627428",
            "mtime": "2024-09-12 00:05",
            "mcontent": "老板明天就要"
        },
        {
            "mid": "10403273",
            "mtime": "2024-09-12 11:15",
            "mcontent": "老哥能讲下如果正常用dns的情况下是咋写吗？  变量？配置文件？"
        },
        {
            "mid": "576146",
            "mtime": "2024-09-12 18:55",
            "mcontent": "以前app开发需要写死ip，因为写域名的话，每次连接都会解析一次，不像电脑解析一次后形成缓存现在不知道安卓高版本有没有改善这点如果是比较健壮的app，一般都是默认弄个ip表文件，然后会去定期访问服务器更新这个表，也就是说自己来做一个域名缓存功能，这么做是最好的，就是麻烦，小公司要是老板要求赶紧做好，没人会花精力弄这个功能"
        },
        {
            "mid": "1781995",
            "mtime": "2024-09-12 21:24",
            "mcontent": "Android在哪个挺早的版本换了okhttp，自带缓存了"
        },
        {
            "mid": "576146",
            "mtime": "2024-09-12 22:45",
            "mcontent": "是的，以前这么写，现在不同了"
        },
        {
            "mid": "992969",
            "mtime": "2024-09-13 07:19",
            "mcontent": "有dns就用域名了啊具体写在环境变量还是从哪个配置读，跟dns一点关系也没有"
        },
        {
            "mid": "63782286",
            "mtime": "2024-09-13 08:02",
            "mcontent": "dns里的记录本来就自带一个ttl 参数，你的dns client是需要根据这个ttl 去刷新的，而且很多功能也是利用这个机制实现的，比如用一个30s的ttl 让client能及时获取server 端的healthy 机器列表。"
        },
        {
            "mid": "8777681",
            "mtime": "2024-09-13 08:03",
            "mcontent": "有除了dns以外的网络高可用机制体系，那就用呗不用dns也能解决一些用dns的问题：比如切换dns后客户端需要等ttl超时，然而客户端基础又不受控比如dns本身基础环境的高可用能力，不能匹配所需要场景的高可用要求(即便DNS挂了，我这个场景也不许挂！)……等等当然也可以用一些其他DNS基础上的缓存和再交易中的信道附加信息等等手段，解决上述类似问题方法不绝对，具体看需求场景"
        },
        {
            "mid": "64114905",
            "mtime": "2024-09-13 11:32",
            "mcontent": "哈哈哈，可太真实了凑合事反而衍生出各式各样奇奇怪怪的需求，比如在K8S里面都要求固定IP"
        },
        {
            "mid": "61493082",
            "mtime": "2024-09-14 15:02",
            "mcontent": "写ip最大的好处就是安全，如果做gov的项目一般甲方的部门都会要求固定ip，来防止病毒进入内网系统没办法溯源的问题，还有些设备可能要做隔离，防火墙会放行某些ip或禁止某些ip访问。总之来说就是简单而古老的“安全”"
        },
        {
            "mid": "64703914",
            "mtime": "2024-09-14 15:25",
            "mcontent": "程序员理解的 IP 写死，是指把 某个或某些IP 地址直接写进代码里，这种情况实际上极少发生。而你遇到的情况是：业务方不希望变更已分配的 IP 地址。这在业务那边太正常不过了。对于一个需要联网，需要与其他业务通信的程序，它可能需要连接数个上游 IP 地址，同时对于可以连接它的下游 IP 地址，可能需要通过设置白名单的方式来授权，通常来说这些相关的 IP 都在配置文件中定义，如果需要变更，通常修改配置文件，然后重启一下程序即可生效。但是重启程序这事，在某些情况下也是一件风险很大的事，尤其是那种运行了几个月甚至一两年都没重启过的程序，甚至最开始的开发人员都不一定能找到，别说修改配置重启，就算不变更配置重启都有很大的风险。比如说重启后程序启动不了，重启后程序连接不到上游的服务器，或者下游的服务器无法连接它了。如果还涉及到复杂一点的变更，比如你想把一个区域的几百台机器，全部从网段 192.168 开头的网段，改为使用 10开头的网段，那涉及多少程序的多少配置文件的改动？而且还是大批量换地址。所以压根就不是程序写死 IP 地址的问题。"
        },
        {
            "mid": "19984060",
            "mtime": "2024-09-20 21:54",
            "mcontent": "应该是懒"
        }
    ]
}